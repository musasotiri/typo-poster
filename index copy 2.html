<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Word Drop Physics (Heavy Bounce)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            border: 2px solid black;
            /* canvas border */
        }
    </style>
</head>

<body>
    <script>
        let Engine = Matter.Engine,
            World = Matter.World,
            Bodies = Matter.Bodies,
            Body = Matter.Body;

        let engine, world;
        let ground, leftWall, rightWall;
        let words = [];
        let buffer = "";
        let cursorVisible = true;
        let lastBlink = 0;
        let fontSize;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            fontSize = height * 0.2; // 20% viewport height
            textSize(fontSize);
            textAlign(LEFT, CENTER);

            engine = Engine.create();
            world = engine.world;
            world.gravity.y = 1.2; // tambah gravity sikit supaya lebih heavy

            // Boundaries
            ground = Bodies.rectangle(width / 2, height, width, 40, { isStatic: true });
            leftWall = Bodies.rectangle(0, height / 2, 40, height, { isStatic: true });
            rightWall = Bodies.rectangle(width, height / 2, 40, height, { isStatic: true });
            World.add(world, [ground, leftWall, rightWall]);
        }

        function draw() {
            background(240);
            Engine.update(engine);

            // Display dropped words
            for (let w of words) {
                let pos = w.body.position;
                let angle = w.body.angle;

                // Clamp supaya tak lebih ground
                if (pos.y > height - 20) {
                    Body.setPosition(w.body, { x: pos.x, y: height - 20 });
                    Body.setVelocity(w.body, { x: 0, y: 0 });
                    Body.setAngularVelocity(w.body, 0);
                }

                push();
                translate(pos.x, pos.y);
                rotate(angle);
                fill(w.color);
                noStroke();
                textAlign(CENTER, CENTER);
                text(w.text, 0, 0);
                pop();
            }

            // Blink cursor
            if (millis() - lastBlink > 500) {
                cursorVisible = !cursorVisible;
                lastBlink = millis();
            }

            fill(0);
            textAlign(LEFT, CENTER);
            let cursorX = 50 + textWidth(buffer);
            text(buffer, 50, fontSize / 2 + 20);
            if (cursorVisible) {
                text("|", cursorX, fontSize / 2 + 20);
            }
        }

        function keyPressed() {
            if (keyCode === BACKSPACE) {
                buffer = buffer.slice(0, -1);
                return false;
            }
            if (keyCode === ENTER) {
                if (buffer.trim().length > 0) {
                    dropWord(buffer);
                    buffer = "";
                }
                return false;
            }
            if (key === ' ') {
                if (buffer.trim().length > 0) {
                    dropWord(buffer);
                    buffer = "";
                }
                return false;
            }
        }

        function keyTyped() {
            if (key.length === 1 && key !== " ") {
                buffer += key;
            }
        }

        function dropWord(word) {
            let tw = textWidth(word);
            let th = fontSize;

            let startX = random(150, width - 150);
            let startY = -100;

            let body = Bodies.rectangle(startX, startY, tw, th, {
                restitution: 0.2, // kurang bounce
                friction: 0.5,
                frictionStatic: 0.8,
                density: 0.01, // lebih berat
                angle: random(-0.1, 0.1)
            });

            // Random push kiri/kanan
            let forceX = random(-0.02, 0.02);
            Body.applyForce(body, body.position, { x: forceX, y: 0 });

            World.add(world, body);

            let c = color(random(30, 70));
            words.push({ body: body, text: word, color: c });
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            fontSize = height * 0.2;
            textSize(fontSize);
        }
    </script>
</body>

</html>