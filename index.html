<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>KataKata - Poster Gravity Effect</title>
    <meta name="title" content="KataKata - Poster Gravity Effect">
    <meta name="description" content="Simple words, big impact. Cipta poster gravity effect & share dengan mudah! ✨">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://katakata.my/">
    <meta property="og:title" content="KataKata - Poster Gravity Effect">
    <meta property="og:description"
        content="Simple words, big impact. Cipta poster gravity effect & share dengan mudah! ✨">
    <meta property="og:image" content="https://katakata.my/wp-content/uploads/2025/07/katakata-home1.png">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://katakata.my/">
    <meta property="twitter:title" content="KataKata - Poster Gravity Effect">
    <meta property="twitter:description"
        content="Simple words, big impact. Cipta poster gravity effect & share dengan mudah! ✨">
    <meta property="twitter:image" content="https://katakata.my/wp-content/uploads/2025/07/katakata-home1.png">

    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: row;
            height: 100vh;
            width: 100vw;
            background-color: #f8f9fa;
            font-family: 'Inter', sans-serif;
            position: relative;
        }

        .left {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.5rem;
            padding-top: 1rem;
        }

        .right {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        input:focus {
            outline: none;
        }

        #input-panel {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        #input-and-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 100%;
        }

        #input-container {
            position: relative;
            flex-grow: 1;
        }

        #message {
            width: 100%;
            padding: 0.75rem 3.5rem 0.75rem 0.75rem;
            font-size: 1rem;
            border-radius: 999px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            font-family: inherit;
        }

        #char-counter {
            width: 100%;
            text-align: left;
            font-size: 0.8rem;
            color: #a3a3a3;
            margin-top: -0.5rem;
            margin-left: 1.5rem;
        }

        #generate-btn {
            position: absolute;
            right: 3px;
            top: 50%;
            transform: translateY(-50%);
            padding: 0.5rem;
            background: #2176FF;
            color: #fff;
            border: none;
            border-radius: 999px;
            cursor: pointer;
            font-size: 1rem;
            line-height: 0;
        }

        #generate-btn[disabled] {
            background: #ced4da;
            cursor: not-allowed;
        }



        #download-btn {
            background-color: transparent;
            padding: 0.5rem;
            cursor: pointer;
            position: absolute;
            bottom: 51px;
            right: -44px;
            border: none;
            outline: none;
        }

        #download-btn svg,
        #share-btn svg {
            stroke: #4a5759;
        }

        #share-btn {
            background-color: transparent;
            padding: 0.5rem;
            cursor: pointer;
            position: absolute;
            bottom: 98px;
            right: -44px;
            border: none;
            outline: none;
        }

        #poster {
            position: relative;
        }

        #poster canvas {
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(52, 58, 64, 0.2);
        }

        #logo-svg {
            position: absolute;
            top: 10px;
            left: 7px;
            width: 5%;
            height: auto;
            z-index: 10;
            visibility: hidden;
        }

        #toast-message {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translate(-50%, -200%);
            background-color: rgba(52, 58, 64, 0.85);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 999px;
            opacity: 0;
            pointer-events: none;
            z-index: 110;
            font-size: small;
            text-align: center;
        }


        #toast-message.show {
            animation: toastDrop 0.3s ease-out forwards;
        }


        #toast-message.hide {
            animation: toastFadeOut 0.5s ease-in forwards;
        }

        @keyframes toastDrop {
            from {
                opacity: 0;
                transform: translate(-50%, -200%);
            }

            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        @keyframes toastFadeOut {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }

            to {
                opacity: 0;
                transform: translate(-50%, 0);
            }
        }

        /* Overlay */
        #success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.6s ease, visibility 0.6s ease;
            z-index: 100;
        }

        /* Active (intro) */
        #success-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* Hide (outro) */
        #success-overlay.hide {
            opacity: 0;
            visibility: hidden;
        }


        .overlay-center {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
        }


        @media(max-width: 768px) {
            body {
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
            }

            .left {
                flex: 2;
                padding: 0;
                margin-top: 5px;
            }

            .right {
                flex: 1;
                width: 90%;
                padding-bottom: 0.5rem;
                margin-top: 4rem;
                align-items: start;
            }

            #input-panel {
                width: 100%;
            }


            #download-btn {
                bottom: -43px;
                right: 18rem;
            }

            #share-btn {
                bottom: -43px;
                right: 15.2rem;
            }


            #success-overlay {
                top: -20%;
            }

            #toast-message {
                width: 65%;
            }
        }
    </style>
</head>

<body>
    <div class="left">
        <div id="poster">
            <button id="share-btn" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-link-icon lucide-link">
                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
                </svg>
            </button>
            <button id="download-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-download-icon lucide-download">
                    <path d="M12 15V3" />
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <path d="m7 10 5 5 5-5" />
                </svg>
            </button>
            <div id="success-overlay" class="overlay-center">
                <dotlottie-player id="success-lottie" src="assets/success.lottie" background="transparent" speed="1"
                    style="width:300px;height:300px">
                </dotlottie-player>
                <div id="toast-message"></div>
            </div>
        </div>
    </div>
    <div class="right">
        <div id="input-panel">
            <div id="input-and-controls">
                <div id="input-container">
                    <input type="text" id="message" maxlength="140" placeholder="Tulis mesej power anda kat sini..." />
                    <button id="generate-btn" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-arrow-right">
                            <path d="M5 12h14" />
                            <path d="m12 5 7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
            <div id="char-counter">0/140</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script type="module" src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.js"></script>

    <script>
        // This is the correct way to instantiate a p5 sketch
        const s = (sketch) => {
            let Engine = Matter.Engine,
                World = Matter.World,
                Bodies = Matter.Bodies;

            let engine, world;
            let words = [];
            let inputField, generateButton, downloadButton, charCounter, shareButton, toastMessage;
            let started = false;
            let lastMessage = "";
            let lastColors = {};

            // --- NEW: Icon SVGs and state tracking variable ---
            const arrowIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right"><path d="M5 12h14" /><path d="m12 5 7 7-7 7" /></svg>`;
            const refreshIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-ccw"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></svg>`;
            let hasGeneratedOnce = false;

            const lightColors = ['#f1faee', '#a8dadc'];
            const darkColors = ['#e63946', '#457b9d', '#1d3557'];
            const lightTextColor = '#1d3557';
            const darkTextColor = '#f1faee';

            let backgroundColor, wordColor, textColor;

            sketch.setup = function () {
                let canvasWidth, canvasHeight;
                const aspectRatio = Math.sqrt(2);

                let viewportH = window.visualViewport ? window.visualViewport.height : window.innerHeight;
                let viewportW = window.visualViewport ? window.visualViewport.width : window.innerWidth;

                if (viewportW > viewportH) {
                    canvasHeight = viewportH * 0.9;
                    canvasWidth = canvasHeight / aspectRatio;
                } else {
                    canvasWidth = viewportW * 0.9;
                    canvasHeight = canvasWidth * aspectRatio;
                }

                let canvas = sketch.createCanvas(canvasWidth, canvasHeight);
                canvas.parent('poster');
                engine = Engine.create();
                world = engine.world;
                Engine.run(engine);

                let ground = Bodies.rectangle(sketch.width / 2, sketch.height + 50, sketch.width, 100, { isStatic: true });
                let leftWall = Bodies.rectangle(-50, sketch.height / 2, 100, sketch.height, { isStatic: true });
                let rightWall = Bodies.rectangle(sketch.width + 50, sketch.height / 2, 100, sketch.height, { isStatic: true });
                World.add(world, [ground, leftWall, rightWall]);

                inputField = document.getElementById("message");
                generateButton = document.getElementById("generate-btn");
                downloadButton = document.getElementById("download-btn");
                charCounter = document.getElementById("char-counter");
                shareButton = document.getElementById("share-btn");
                toastMessage = document.getElementById("toast-message");

                generateButton.addEventListener("click", generatePoster);
                downloadButton.addEventListener("click", downloadPoster);
                shareButton.addEventListener("click", sharePoster);
                inputField.addEventListener("keypress", function (e) {
                    if (e.key === "Enter") generatePoster();
                });

                // --- MODIFIED: Input listener ---
                inputField.addEventListener("input", function () {
                    updateCharCount();
                    updateButtonState();
                    if (inputField.value.trim().length === 0) {
                        generateButton.innerHTML = arrowIconSVG;
                        hasGeneratedOnce = false; // Reset state
                        shareButton.hidden = true;
                    } else if (hasGeneratedOnce) {
                        generateButton.innerHTML = refreshIconSVG;
                    }
                });

                checkUrlAndLoadPoster();

                function downloadPoster() {
                    const filename = "katakata-gravity-poster";
                    const fileExtension = 'png';

                    sketch.saveCanvas(filename, fileExtension);
                }


            };

            sketch.windowResized = function () {
                let canvasWidth, canvasHeight;
                const aspectRatio = Math.sqrt(2);

                let viewportH = window.visualViewport ? window.visualViewport.height : window.innerHeight;
                let viewportW = window.visualViewport ? window.visualViewport.width : window.innerWidth;

                if (viewportW > viewportH) {
                    canvasHeight = viewportH * 0.9;
                    canvasWidth = canvasHeight / aspectRatio;
                } else {
                    canvasWidth = viewportW * 0.9;
                    canvasHeight = canvasWidth * aspectRatio;
                }

                sketch.resizeCanvas(canvasWidth, canvasHeight);
                World.clear(world, false);
                let ground = Bodies.rectangle(sketch.width / 2, sketch.height + 50, sketch.width, 100, { isStatic: true });
                let leftWall = Bodies.rectangle(-50, sketch.height / 2, 100, sketch.height, { isStatic: true });
                let rightWall = Bodies.rectangle(sketch.width + 50, sketch.height / 2, 100, sketch.height, { isStatic: true });
                World.add(world, [ground, leftWall, rightWall]);
                if (lastMessage.length > 0) {
                    createWords(lastMessage, lastColors);
                }
            };

            sketch.draw = function () {
                sketch.background(backgroundColor);

                if (started) {
                    for (let w of words) {
                        w.show(sketch);
                    }
                }
            };

            function checkUrlAndLoadPoster() {
                if (!window.location.hash || window.location.hash.length <= 1) {
                    loadDefaultPoster();
                    return;
                }

                const rawHash = window.location.hash.substring(1);
                let posterData = null;

                try {
                    const decompressed = LZString.decompressFromEncodedURIComponent(rawHash);
                    if (decompressed) {
                        posterData = JSON.parse(decompressed);
                    }
                } catch (e) {
                    console.warn("LZString decompress failed, fallback:", e);
                    try {
                        const decoded = decodeURIComponent(escape(atob(rawHash)));
                        if (decoded) posterData = JSON.parse(decoded);
                    } catch (e) {
                        try {
                            const uriDecoded = decodeURIComponent(rawHash);
                            posterData = JSON.parse(uriDecoded);
                        } catch (e) {
                            console.error("URL hash parsing failed:", e);
                        }
                    }
                }

                if (posterData && posterData.message && posterData.message.length > 0) {
                    posterData.colors = posterData.colors || {};
                    posterData.colors.backgroundColor = posterData.colors.backgroundColor || "#f1faee";
                    posterData.colors.wordColor = posterData.colors.wordColor || "#1d3557";
                    posterData.colors.textColor = posterData.colors.textColor || "#f1faee";

                    lastMessage = posterData.message;
                    lastColors = posterData.colors;
                    createWords(lastMessage, lastColors);
                    started = true;
                    if (typeof inputPanel !== "undefined" && inputPanel) inputPanel.style.display = "none";
                    if (typeof shareButton !== "undefined" && shareButton) shareButton.hidden = false;

                } else {
                    console.warn("No valid poster data found in URL; loading default poster.");
                    loadDefaultPoster();
                }
            }

            function loadDefaultPoster() {
                lastMessage = "1% better, setiap hari";
                setHighContrastColors();
                createWords(lastMessage, lastColors);
                started = true;
            }

            function updateCharCount() {
                charCounter.textContent = `${inputField.value.length}/140`;
            }

            function updateButtonState() {
                generateButton.disabled = inputField.value.trim().length === 0;
            }

            // --- MODIFIED: generatePoster function ---
            function generatePoster() {
                lastMessage = inputField.value.trim();
                if (lastMessage.length === 0) return;

                setHighContrastColors();
                createWords(lastMessage, lastColors);
                started = true;
                updateCharCount();
                updateButtonState();
                shareButton.hidden = false;

                // Change icon to refresh and set state
                if (!hasGeneratedOnce) {
                    hasGeneratedOnce = true;
                }
                generateButton.innerHTML = refreshIconSVG;
            }

            function refreshPoster() {
                if (lastMessage.length > 0) {
                    setHighContrastColors();
                    createWords(lastMessage, lastColors);
                    started = true;
                }
            }

            function downloadPoster() {
                // You can name the file whatever you want
                const filename = "katakata-poster";
                // Choose your desired file format (e.g., 'png', 'jpg')
                const fileExtension = 'png';

                // The p5.js function that saves the canvas content
                sketch.saveCanvas(filename, fileExtension);
            }

            function sharePoster() {
                if (!lastMessage || lastMessage.length === 0) {
                    showToast("Oops, kena generate poster dulu then boleh share 👍");
                    return;
                }

                const data = {
                    message: lastMessage,
                    colors: lastColors
                };
                const jsonString = JSON.stringify(data);

                const encodedData = LZString.compressToEncodedURIComponent(jsonString);
                const shareUrl = window.location.origin + window.location.pathname + '#' + encodedData;

                navigator.clipboard.writeText(shareUrl).then(() => {
                    showSuccessOverlay();
                    showToast("Link dah copy, boleh paste & share 🚀");
                }).catch(err => {
                    console.error("Failed to copy link:", err);
                    showToast("Alamak… link tak berjaya dicopy 😅 Cuba lagi.");
                });
            }

            function showSuccessOverlay() {
                const overlay = document.getElementById('success-overlay');
                const anim = document.getElementById('success-lottie');

                overlay.classList.remove("hide");
                overlay.classList.add("show");

                overlay.style.display = 'flex';
                anim.seek(0);
                anim.play();
                setTimeout(() => {
                    overlay.classList.remove("show");
                    overlay.classList.add("hide");
                }, 4000);
            }

            function showToast(message) {
                toastMessage.textContent = message;
                toastMessage.classList.add("show");
                setTimeout(() => {
                    toastMessage.classList.remove("show");
                }, 4000);
            }

            function setHighContrastColors() {
                const pick = (arr) => arr[sketch.floor(sketch.random(arr.length))];

                const isLightTheme = sketch.random() > 0.5;
                if (isLightTheme) {
                    backgroundColor = pick(lightColors);
                    wordColor = pick(darkColors);
                    textColor = darkTextColor;
                } else {
                    backgroundColor = pick(darkColors);
                    wordColor = pick(lightColors);
                    textColor = lightTextColor;
                }
                lastColors = {
                    backgroundColor: backgroundColor,
                    wordColor: wordColor,
                    textColor: textColor
                };
            }

            function calculateFontSize(parts) {
                const diagonal = sketch.sqrt(sketch.width * sketch.width + sketch.height * sketch.height);
                let baseFontSize = diagonal * 0.1;

                const longestWord = parts.reduce((a, b) => a.length > b.length ? a : b, "");
                sketch.textSize(baseFontSize);
                const longestWidth = sketch.textWidth(longestWord);

                let adjusted = baseFontSize;
                if (longestWidth > sketch.width * 0.9) {
                    adjusted *= (sketch.width * 0.9 / longestWidth);
                }

                const numWords = parts.length;
                const maxWordsForScaling = 25;
                let scalingFactor = 1.0;

                if (numWords > 1) {
                    const normalizedWordCount = sketch.min(numWords, maxWordsForScaling) / maxWordsForScaling;
                    scalingFactor = sketch.pow(1 - normalizedWordCount, 0.4);
                }
                adjusted *= scalingFactor;

                const minSize = sketch.height * 0.05;
                adjusted = sketch.max(adjusted, minSize);

                return adjusted;
            }

            function createWords(msg, colors) {
                if (words.length > 0) {
                    for (let i = 0; i < words.length; i++) {
                        World.remove(world, words[i].body);
                    }
                }
                words = [];

                backgroundColor = colors.backgroundColor;
                wordColor = colors.wordColor;
                textColor = colors.textColor;

                const processedMsg = msg.replace(/([.,!?;:])(?=\S)/g, '$1 ');
                let parts = processedMsg.trim().split(/\s+/).filter(Boolean);

                if (parts.length === 0) return;

                if (parts.length > 7) {
                    let mergedParts = [];
                    let i = 0;
                    while (i < parts.length) {
                        const shouldMerge = sketch.random() < 0.5;
                        if (shouldMerge && i + 1 < parts.length) {
                            const mergedText = parts[i] + ' ' + parts[i + 1];
                            sketch.textSize(calculateFontSize(parts));
                            if (sketch.textWidth(mergedText) < sketch.width * 0.6) {
                                mergedParts.push(mergedText);
                                i += 2;
                            } else {
                                mergedParts.push(parts[i]);
                                i += 1;
                            }
                        } else {
                            mergedParts.push(parts[i]);
                            i += 1;
                        }
                    }
                    parts = mergedParts;
                }

                parts = parts.map(word => word.toUpperCase());

                let adjustedFontSize = calculateFontSize(parts);

                parts.reverse().forEach((w, i) => {
                    let x = sketch.width / 2 + sketch.random(-50, 50);
                    let y = -200 - i * (adjustedFontSize * 1.5);
                    words.push(new Word(w, x, y, adjustedFontSize, wordColor, textColor));
                });
            }

            class Word {
                constructor(word, x, y, fontSize, color, textColor) {
                    this.word = word;
                    this.fontSize = fontSize;
                    this.color = color;
                    this.textColor = textColor;

                    sketch.textSize(this.fontSize);
                    this.textWidth = sketch.textWidth(word);

                    const visualPaddingX = 30;
                    const visualPaddingY = 10;
                    const physicsPadding = 4;

                    const blockWidth = this.textWidth + visualPaddingX + physicsPadding;
                    const blockHeight = this.fontSize + visualPaddingY + physicsPadding;

                    this.body = Bodies.rectangle(x, y, blockWidth, blockHeight, {
                        restitution: 0.05,
                        friction: 0.35,
                        angle: sketch.random(-sketch.PI / 4, sketch.PI / 4)
                    });
                    World.add(world, this.body);
                }

                show() {
                    let pos = this.body.position;
                    this.body.angle = sketch.constrain(this.body.angle, -sketch.PI / 4, sketch.PI / 4);
                    let angle = this.body.angle;

                    sketch.push();
                    sketch.translate(pos.x, pos.y);
                    sketch.rotate(angle);

                    sketch.rectMode(sketch.CENTER);
                    sketch.noStroke();
                    sketch.fill(this.color);

                    const visualPaddingX = 30;
                    const visualPaddingY = 10;
                    sketch.rect(0, 0, this.textWidth + visualPaddingX, this.fontSize + visualPaddingY);

                    sketch.fill(this.textColor);

                    // Set both horizontal and vertical alignment to CENTER
                    sketch.textAlign(sketch.CENTER, sketch.CENTER);

                    // Define different offsets for desktop and mobile
                    let verticalOffset;
                    if (window.innerWidth <= 768) {
                        // Offset for mobile devices
                        verticalOffset = 1; // Adjust this value to get perfect centering on mobile
                    } else {
                        // Offset for desktop devices
                        verticalOffset = 7; // Adjust this value to get perfect centering on desktop
                    }

                    // Draw the text with the conditional vertical offset
                    sketch.text(this.word, 0, verticalOffset);

                    sketch.pop();
                }
            }
        };

        let myp5 = new p5(s);
    </script>


</body>

</html>